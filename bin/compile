#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir>

set -e            # fail fast
set -o pipefail   # don't ignore exit codes when piping output
#set -x          # enable debugging

# Configure directories
build_dir=$1
cache_dir=$2

# Version
varnish_version="7.5.0"

compile_buildpack_dir=$(cd $(dirname $0); cd ..; pwd)
compile_buildpack_bin=$compile_buildpack_dir/bin

# Load some convenience functions like status(), echo(), and indent()
source $compile_buildpack_dir/bin/common.sh

compile_varnish_tar_gz="$compile_buildpack_dir/vendor/varnish-cache-$varnish_version.tar.gz"

status "Un-tar Varnish"
mkdir $varnish_version
cd $varnish_version
pwd
ls -l

# UN tar the files
echo $compile_varnish_tar_gz
tar xzf $compile_varnish_tar_gz
pwd
ls -l

cd varnish-cache
pwd
ls -l
cd sbin
pwd
ls -l
varnishstat -V

status "Build dependencies for Ubuntu"
#ps aux | grep -e apt -e dpkg
#cd /var/lib/dpkg/
pwd
ls -l
#apt-get install -y make --no-install-recommends

pwd
ls -l



#cp -r $build_dir/varnish/* .

ls -l
#cat default.vcl
echo $compile_buildpack_bin
cd $compile_buildpack_bin
ls -l

if [[ ! -f boot.sh ]]; then
    cp $compile_buildpack_bin/boot.sh .    
fi
